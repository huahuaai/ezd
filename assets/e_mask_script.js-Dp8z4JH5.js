import{i as v}from"./interact.min-DamJm7fn.js";import{s as z}from"./utils-C4Bj6WAK.js";import"./_commonjsHelpers-Cpj98o6Y.js";const $=e=>{v(e).draggable({modifiers:[v.modifiers.restrictRect({restriction:"parent",endOnly:!0})],listeners:{move(n){const o=n.target;let t=(parseFloat(o.getAttribute("data-x"))||0)+n.dx,i=(parseFloat(o.getAttribute("data-y"))||0)+n.dy;o.style.transform=`translate(${t}px, ${i}px)`,o.setAttribute("data-x",t),o.setAttribute("data-y",i)}}}).resizable({edges:{left:!0,right:!0,bottom:!0,top:!0},margin:5,modifiers:[v.modifiers.restrictEdges({outer:"parent",endOnly:!0}),v.modifiers.restrictSize({min:{width:40,height:20},max:{width:2e3,height:2e3}})],listeners:{move(n){const o=n.target;let t=parseFloat(o.getAttribute("data-x"))||0,i=parseFloat(o.getAttribute("data-y"))||0;o.style.width=`${n.rect.width}px`,o.style.height=`${n.rect.height}px`,t+=n.deltaRect.left,i+=n.deltaRect.top,o.style.transform=`translate(${t}px, ${i}px)`,o.setAttribute("data-x",t),o.setAttribute("data-y",i)}}}).on("resizestart",function(n){n.target.style.cursor="nwse-resize"}).on("resizeend",function(n){n.target.style.cursor="move"})},H=e=>{let n=0;v(e).draggable({modifiers:[v.modifiers.restrictRect({restriction:"parent",endOnly:!0})],listeners:{move(o){const t=o.target;let i=(parseFloat(t.getAttribute("data-x"))||0)+o.dx,c=(parseFloat(t.getAttribute("data-y"))||0)+o.dy;t.style.transform=`translate(${i}px, ${c}px) rotate(${n}deg)`,t.setAttribute("data-x",i),t.setAttribute("data-y",c)}}}).resizable({edges:{left:!0,right:!0,bottom:!0,top:!0},margin:5,modifiers:[v.modifiers.restrictEdges({outer:"parent",endOnly:!0}),v.modifiers.restrictSize({min:{width:20,height:20},max:{width:2e3,height:2e3}}),v.modifiers.aspectRatio({ratio:"preserve",modifiers:[v.modifiers.restrictEdges({outer:"parent",endOnly:!0}),v.modifiers.restrictSize({min:{width:10,height:10},max:{width:2e3,height:2e3}})]})],listeners:{move(o){const t=o.target;let i=parseFloat(t.getAttribute("data-x"))||0,c=parseFloat(t.getAttribute("data-y"))||0;t.style.width=`${o.rect.width}px`,t.style.height=`${o.rect.height}px`,i+=o.deltaRect.left,c+=o.deltaRect.top,t.style.transform=`translate(${i}px, ${c}px) rotate(${n}deg)`,t.setAttribute("data-x",i),t.setAttribute("data-y",c)}}}).on("resizestart",function(o){o.target.style.cursor="nwse-resize"}).on("resizeend",function(o){o.target.style.cursor="move"})},r=document.createElement("div");r.classList.add("ezdrop-mask");const k=()=>{document.body.querySelector(".ezdrop-mask")&&document.body.removeChild(document.body.querySelector(".ezdrop-mask")),document.body.appendChild(r)},S=()=>{document.body.removeChild(document.body.querySelector(".ezdrop-mask"))},L=e=>{let n=document.body.querySelector(".ezdrop-mask").querySelector(".img-container"),o=n.querySelectorAll(".img-hotzone"),t=n.getBoundingClientRect();const i=t.x,c=t.y,h=t.width,b=t.height;let u=[],s=[],a=[],m=[];for(let g of o){const y=g.getBoundingClientRect();u.push((y.x-i)/h*100),s.push((y.y-c)/b*100),a.push(y.width/h*100),m.push(y.height/b*100)}z("updatedHotZone",{key:e,hotx:u,hoty:s,hotw:a,hoth:m}),document.body.removeChild(document.body.querySelector(".ezdrop-mask"))},q=()=>{r.querySelector(".hotzone-container")&&r.removeChild(r.querySelector(".hotzone-container")),r.querySelector(".svgcanvas-container")&&r.removeChild(r.querySelector(".svgcanvas-container")),r.querySelector(".hotzone-button")&&r.removeChild(r.querySelector(".hotzone-button")),r.querySelector(".tooltip-container")&&r.removeChild(r.querySelector(".tooltip-container")),r.querySelector(".svgcanvas-button")&&r.removeChild(r.querySelector(".svgcanvas-button"))},w=e=>{const n=`
    <div class="hotzone-container">
        <div class="img-container">
            <img class="img"  data-key="${e.key}" src="${e.imgurl}">
        </div>
    </div>
    `,o=document.createElement("div");o.innerHTML=n;const t=o.querySelector(".img");t.onload=()=>{const l=t.naturalWidth,p=t.naturalHeight;l>p?(t.style.width="750px",t.style.height="auto"):(t.style.width="auto",t.style.height="750px")};const i=["#12a3ff","#30c0ff","#54e3ff","#37f4b0","#02cca6","#b1ef7b","#f4e916","#f2af19","#ef701b","#ff80e1"];let c=e.hotx,h=e.hoty,b=e.hotw,u=e.hoth,s=[];for(let l=0;l<e.cnt;l++){const p=i[l%i.length];s.push(p)}const a=o.querySelector(".img-container");for(let l=0;l<e.cnt;++l){const p=document.createElement("div");p.classList.add("img-hotzone"),p.style.left=`${c[l]}%`,p.style.top=`${h[l]}%`,p.style.width=`${b[l]}%`,p.style.height=`${u[l]}%`,p.style.backgroundColor=s[l],p.textContent=`热区${l+1}`,$(p),a.appendChild(p)}q();const m=`
    <div class="hotzone-button">
        <button class="cancel-button">取消</button>
        <button class="save-button">保存</button>
    </div>
    `,g=document.createElement("div");g.innerHTML=m,g.querySelector(".cancel-button").addEventListener("click",()=>S()),g.querySelector(".save-button").addEventListener("click",()=>L(e.key)),r.appendChild(g.querySelector(".hotzone-button"));const y=`
    <div class="tooltip-container">
        <div>彩色热区<div style="display:inline-block;background-color:red;border: 2px dashed #FFF;opacity: 0.66;margin-left:2px;margin-right:2px;padding:0px;width:12px;height:12px;"></div>代表可触发区域 </div>
        <div>拖动热区边缘，调整大小；拖动热区，调整位置</div>
    </div>
    `,f=document.createElement("div");f.innerHTML=y,r.appendChild(f.querySelector(".tooltip-container")),r.appendChild(o.querySelector(".hotzone-container"))},E=e=>{console.log(e);let n=e.eldict,o=document.body.querySelector(".ezdrop-mask").querySelector(".img-container"),t=o.querySelectorAll(".effect-element"),i=o.getBoundingClientRect();console.log(n);const c=i.x,h=i.y,b=i.width,u=i.height;for(let s of t){s.childNodes[0];const a=s.getBoundingClientRect();n[s.dataset.key].elx=(a.x-c)/b*100,n[s.dataset.key].ely=(a.y-h)/u*100,n[s.dataset.key].elw=a.width/b*100,n[s.dataset.key].elh=a.height/u*100}console.log(n),z("updatedSvgCanvas",{key:e.key,eldict:n}),document.body.removeChild(document.body.querySelector(".ezdrop-mask"))},C=e=>{q(),console.log(e);const n=`
    <div class="svgcanvas-container">
        <div class="img-container">
            <div class="background" data-key="${e.key}"></div>
        </div>
    </div>
    `,o=document.createElement("div");o.innerHTML=n;const t=o.querySelector(".background");let i=e.backgroundinfo[0],c=e.backgroundinfo[1],h=e.backgroundinfo[2];t.innerHTML=i,console.log(t.childNodes[0]),t.childNodes[0].tagName!=="svg"&&(t.childNodes[0].style.position="absolute",t.childNodes[0].style.height="100%",t.childNodes[0].style.width="100%"),c>h?(t.style.width="750px",t.style.height=`${h*750/c}px`):(t.style.width=`${c*750/h}px`,t.style.height="750px");for(let s of e.keylist){let a=e.eldict[s];console.log(a);let m=a.elcode;if(m!==""){let g=a.elx,y=a.ely,f=a.elw,l=a.elh;const p=o.querySelector(".img-container");let d=document.createElement("div");d.innerHTML=m,d=d.childNodes[0],d.style.pointerEvents="all",d.classList.add("effect-element"),d.dataset.key=s,d.style.left=`${g}%`,d.style.top=`${y}%`,f!=="auto"?d.style.width=`${f}%`:d.style.width=`${f}`,l!=="auto"?d.style.height=`${l}%`:d.style.height=`${l}`,console.log(d),console.log(d.childNodes[0]),d.childNodes[0].tagName!=="svg"&&(d.childNodes[0].style.height="100%",d.childNodes[0].style.width="100%"),H(d),p.appendChild(d)}}const b=`
    <div class="svgcanvas-button">
        <button class="cancel-button">取消</button>
        <button class="save-button">保存</button>
    </div>
    `,u=document.createElement("div");u.innerHTML=b,u.querySelector(".cancel-button").addEventListener("click",()=>S()),u.querySelector(".save-button").addEventListener("click",()=>E(e)),r.appendChild(u.querySelector(".svgcanvas-button")),r.appendChild(o.querySelector(".svgcanvas-container"))},_=e=>{q();const n=`
    <div class="hotzone-container">
        <div class="img-container">
            <div class="background" data-key="${e.key}"></div>
        </div>
    </div>
    `,o=document.createElement("div");o.innerHTML=n;const t=o.querySelector(".background");let i=e.backgroundinfo[0],c=e.backgroundinfo[1],h=e.backgroundinfo[2];t.innerHTML=i,c>h?(t.style.width="750px",t.style.height=`${h*750/c}px`):(t.style.width=`${c*750/h}px`,t.style.height="750px");const b="red";let u=e.hotx,s=e.hoty,a=e.hotw,m=e.hoth;const g=o.querySelector(".img-container"),y=document.createElement("div");y.classList.add("audio-hotzone"),y.style.left=`${u}%`,y.style.top=`${s}%`,y.style.width=`${a}%`,y.style.height=`${m}%`,y.style.backgroundColor=b,$(y),g.appendChild(y);const f=`
    <div class="hotzone-button">
        <button class="cancel-button">取消</button>
        <button class="save-button">保存</button>
    </div>
    `,l=document.createElement("div");l.innerHTML=f,l.querySelector(".cancel-button").addEventListener("click",()=>S()),l.querySelector(".save-button").addEventListener("click",()=>A(e.key)),r.appendChild(l.querySelector(".hotzone-button"));const p=`
    <div class="tooltip-container">
        <div>彩色热区<div style="display:inline-block;background-color:red;border: 2px dashed #FFF;opacity: 0.66;margin-left:2px;margin-right:2px;padding:0px;width:12px;height:12px;"></div>代表可触发区域 </div>
        <div>拖动热区边缘，调整大小；拖动热区，调整位置</div>
    </div>
    `,d=document.createElement("div");d.innerHTML=p,r.appendChild(d.querySelector(".tooltip-container")),r.appendChild(o.querySelector(".hotzone-container"))},A=e=>{let n=document.body.querySelector(".ezdrop-mask").querySelector(".img-container"),o=n.querySelector(".audio-hotzone"),t=n.getBoundingClientRect();const i=t.x,c=t.y,h=t.width,b=t.height;let u=0,s=0,a=0,m=0;const g=o.getBoundingClientRect();u=(g.x-i)/h*100,s=(g.y-c)/b*100,a=g.width/h*100,m=g.height/b*100,z("updatedAudioHotZone",{key:e,hotx:u,hoty:s,hotw:a,hoth:m}),document.body.removeChild(document.body.querySelector(".ezdrop-mask"))};let R=()=>{x&&x.disconnect(),x=chrome.runtime.connect({name:"emask"}),x.onMessage.addListener(e=>{e.showhotzone&&(k(),w(e)),e.freshhotzone&&r.querySelector(".img").dataset.key===e.key&&document.body.querySelector(".ezdrop-mask")&&w(e),e.closehotzone&&document.body.querySelector(".ezdrop-mask")&&document.body.removeChild(document.body.querySelector(".ezdrop-mask")),e.showsvgcanvas&&(k(),C(e)),e.freshsvgcanvas&&r.querySelector(".background").dataset.key===e.key&&document.body.querySelector(".ezdrop-mask")&&C(e),e.closesvgcanvas&&document.body.querySelector(".ezdrop-mask")&&document.body.removeChild(document.body.querySelector(".ezdrop-mask")),e.showaudiohotzone&&(k(),_(e))}),x.onDisconnect.addListener(()=>{console.log("连接断开"),x=null}),console.log("重新连接")},x=null;R();
