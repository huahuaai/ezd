chrome.runtime.onMessage.addListener((e,n,t)=>(e.getDropBtn&&fetch(chrome.runtime.getURL("src/components/dropbtn.html")).then(r=>r.text()).then(r=>{t({drop_btn_string:r})}).catch(r=>console.error(r)),!0));chrome.runtime.onMessage.addListener((e,n,t)=>(e.opensidepanel&&chrome.tabs.query({active:!0,currentWindow:!0},function(r){let o=r[0];chrome.sidePanel.open({tabId:o.id})}),!0));const d=/^https:\/\/mp\.weixin\.qq\.com\/cgi-bin\/.*$/;chrome.tabs.onUpdated.addListener(async(e,n,t)=>{if(!t.url)return;const r=new URL(t.url);d.test(r)?await chrome.sidePanel.setOptions({tabId:e,path:"src/sidepanel/index.html",enabled:!0}):await chrome.sidePanel.setOptions({tabId:e,enabled:!1})});chrome.windows.onRemoved.addListener(function(){chrome.windows.getAll({populate:!1},function(e){e.length===0&&(chrome.storage.local.clear(function(){console.log("本地存储已清空")}),chrome.storage.local.get("cachedElementData",function(n){console.log(n)}))})});chrome.tabs.onActivated.addListener(()=>{chrome.runtime.sendMessage({loadData:!0})});let s="";chrome.runtime.onMessage.addListener((e,n,t)=>{e.savedCode&&(s=e.savedCode)});chrome.runtime.onConnect.addListener(e=>{e.name==="svgcode"&&chrome.runtime.onMessage.addListener((n,t,r)=>{n.savedCode&&e.postMessage({svgcode:n.savedCode})})});chrome.runtime.onMessage.addListener((e,n,t)=>e.hascode?t({svgcode:s}):!0);chrome.runtime.onMessage.addListener((e,n,t)=>(e.clearcode&&(s=""),!0));
