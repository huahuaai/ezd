chrome.runtime.onMessage.addListener((e,o,t)=>(e.getImportBtn&&fetch(chrome.runtime.getURL("src/components/importbtn.html")).then(n=>n.text()).then(n=>{t({import_btn_string:n})}).catch(n=>console.error(n)),!0));chrome.runtime.onMessage.addListener((e,o,t)=>(e.getDropBtn&&fetch(chrome.runtime.getURL("src/components/dropbtn.html")).then(n=>n.text()).then(n=>{t({drop_btn_string:n})}).catch(n=>console.error(n)),!0));chrome.runtime.onMessage.addListener((e,o,t)=>(e.getOpenspBtn&&fetch(chrome.runtime.getURL("src/components/opensidepanelbtn.html")).then(n=>n.text()).then(n=>{t({opensp_btn_string:n})}).catch(n=>console.error(n)),!0));chrome.runtime.onMessage.addListener((e,o,t)=>(e.getSavedCode&&console.log("a"),!0));let r="",c=e=>{chrome.storage.local.remove(e,()=>{console.log("Data removed for key",e)})};chrome.tabs.onUpdated.addListener(()=>{chrome.tabs.query({url:"https://mp.weixin.qq.com/cgi-bin/*"},function(e){console.log(e),r=e[0].id,console.log(r)})});chrome.runtime.onMessage.addListener((e,o,t)=>(e.docloaded&&(console.log("loaded"),t({wxTabId:r})),!0));chrome.runtime.onMessage.addListener((e,o,t)=>(e.opensidepanel&&(console.log("open",r),chrome.sidePanel.open({tabId:r})),!0));const a=/^https:\/\/mp\.weixin\.qq\.com\/cgi-bin\/.*$/;chrome.tabs.onUpdated.addListener(async(e,o,t)=>{if(!t.url)return;const n=new URL(t.url);a.test(n)?await chrome.sidePanel.setOptions({tabId:e,path:"src/sidepanel/index.html",enabled:!0}):await chrome.sidePanel.setOptions({tabId:e,enabled:!1})});chrome.tabs.onRemoved.addListener(function(e,o){e===r&&(console.log("我关心的标签页被关闭了"),c("cachedElementData"),c("cachedCountData"))});let s=null;chrome.runtime.onConnect.addListener(e=>{console.log(e),e.name==="getSidePanelStatus"&&(s=e),console.log(s),e.name==="SidePanel"&&(s.postMessage({spopen:!0}),e.onDisconnect.addListener(()=>{s.postMessage({spclose:!0})}))});chrome.windows.onRemoved.addListener(function(){chrome.windows.getAll({},function(e){e.length===0&&chrome.storage.local.clear(function(){console.log("本地存储已清空")})})});
