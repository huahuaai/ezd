import{i as b}from"./interact.min-DamJm7fn.js";import{s as S}from"./utils-C4Bj6WAK.js";import"./_commonjsHelpers-Cpj98o6Y.js";const L=e=>{b(e).draggable({modifiers:[b.modifiers.restrictRect({restriction:"parent",endOnly:!0})],listeners:{move(n){const o=n.target;let t=(parseFloat(o.getAttribute("data-x"))||0)+n.dx,i=(parseFloat(o.getAttribute("data-y"))||0)+n.dy;o.style.transform=`translate(${t}px, ${i}px)`,o.setAttribute("data-x",t),o.setAttribute("data-y",i)}}}).resizable({edges:{left:!0,right:!0,bottom:!0,top:!0},margin:5,modifiers:[b.modifiers.restrictEdges({outer:"parent",endOnly:!0}),b.modifiers.restrictSize({min:{width:40,height:20},max:{width:2e3,height:2e3}})],listeners:{move(n){const o=n.target;let t=parseFloat(o.getAttribute("data-x"))||0,i=parseFloat(o.getAttribute("data-y"))||0;o.style.width=`${n.rect.width}px`,o.style.height=`${n.rect.height}px`,t+=n.deltaRect.left,i+=n.deltaRect.top,o.style.transform=`translate(${t}px, ${i}px)`,o.setAttribute("data-x",t),o.setAttribute("data-y",i)}}}).on("resizestart",function(n){n.target.style.cursor="nwse-resize"}).on("resizeend",function(n){n.target.style.cursor="move"})},k=e=>{let n=0;b(e).draggable({listeners:{move(o){const t=o.target;let i=(parseFloat(t.getAttribute("data-x"))||0)+o.dx,l=(parseFloat(t.getAttribute("data-y"))||0)+o.dy;t.style.transform=`translate(${i}px, ${l}px) rotate(${n}deg)`,t.setAttribute("data-x",i),t.setAttribute("data-y",l)}}}).resizable({edges:{left:!0,right:!0,bottom:!0,top:!0},margin:5,modifiers:[b.modifiers.restrictSize({min:{width:20,height:20},max:{width:2e3,height:2e3}}),b.modifiers.aspectRatio({ratio:"preserve",modifiers:[b.modifiers.restrictEdges({outer:"parent",endOnly:!0}),b.modifiers.restrictSize({min:{width:10,height:10},max:{width:2e3,height:2e3}})]})],listeners:{move(o){const t=o.target;let i=parseFloat(t.getAttribute("data-x"))||0,l=parseFloat(t.getAttribute("data-y"))||0;t.style.width=`${o.rect.width}px`,t.style.height=`${o.rect.height}px`,i+=o.deltaRect.left,l+=o.deltaRect.top,t.style.transform=`translate(${i}px, ${l}px) rotate(${n}deg)`,t.setAttribute("data-x",i),t.setAttribute("data-y",l)}}}).on("resizestart",function(o){o.target.style.cursor="nwse-resize"}).on("resizeend",function(o){o.target.style.cursor="move"})},z=`<svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M0.359118 13.3726C0.198636 13.2121 0.0907261 13.0239 0.0353875 12.8081C-0.0144171 12.5868 -0.0116502 12.3709 0.0436883 12.1606C0.0990269 11.9448 0.201403 11.7622 0.350817 11.6128L5.09056 6.86475L0.350817 2.125C0.201403 1.97559 0.0990269 1.79297 0.0436883 1.57715C-0.00611636 1.36133 -0.00611636 1.14551 0.0436883 0.929688C0.0990269 0.713867 0.20417 0.525716 0.359118 0.365234C0.5196 0.199219 0.707751 0.0913086 0.923571 0.0415039C1.14493 -0.00830078 1.36351 -0.00830078 1.57933 0.0415039C1.79515 0.0913086 1.98054 0.193685 2.13549 0.348633L6.87523 5.08008L11.6067 0.348633C11.7616 0.193685 11.947 0.0913086 12.1628 0.0415039C12.3786 -0.0138346 12.5917 -0.0138346 12.802 0.0415039C13.0178 0.0968425 13.2087 0.204753 13.3747 0.365234C13.5352 0.525716 13.6431 0.713867 13.6985 0.929688C13.7538 1.14551 13.7538 1.36133 13.6985 1.57715C13.6487 1.78743 13.5463 1.97282 13.3913 2.1333L8.6599 6.86475L13.3913 11.6045C13.5463 11.7594 13.6487 11.9448 13.6985 12.1606C13.7483 12.3765 13.7455 12.5923 13.6902 12.8081C13.6404 13.0239 13.5352 13.2121 13.3747 13.3726C13.2143 13.533 13.0261 13.6382 12.8103 13.688C12.5945 13.7433 12.3786 13.7461 12.1628 13.6963C11.947 13.6465 11.7616 13.5413 11.6067 13.3809L6.87523 8.64941L2.13549 13.3892C1.98054 13.5386 1.79515 13.6382 1.57933 13.688C1.36905 13.7433 1.15323 13.7433 0.931872 13.688C0.716052 13.6382 0.525134 13.533 0.359118 13.3726Z" fill="#12A3FF"/>
</svg>
`,h=document.createElement("div");h.classList.add("ezdrop-mask");const C=()=>{document.body.querySelector(".ezdrop-mask")&&document.body.removeChild(document.body.querySelector(".ezdrop-mask")),document.body.appendChild(h)},_=e=>{let n=document.body.querySelector(".ezdrop-mask").querySelector(".img-container"),o=n.querySelectorAll(".img-hotzone"),t=n.getBoundingClientRect();const i=t.x,l=t.y,u=t.width,f=t.height;let y=[],s=[],d=[],p=[];for(let a of o){const r=a.getBoundingClientRect();y.push((r.x-i)/u*100),s.push((r.y-l)/f*100),d.push(r.width/u*100),p.push(r.height/f*100)}S("updatedHotZone",{key:e,hotx:y,hoty:s,hotw:d,hoth:p}),document.body.removeChild(document.body.querySelector(".ezdrop-mask"))},q=()=>{h.querySelector(".hotzone-container")&&h.removeChild(h.querySelector(".hotzone-container")),h.querySelector(".svgcanvas-container")&&h.removeChild(h.querySelector(".svgcanvas-container")),h.querySelector(".hotzone-button")&&h.removeChild(h.querySelector(".hotzone-button")),h.querySelector(".tooltip-container")&&h.removeChild(h.querySelector(".tooltip-container")),h.querySelector(".svgcanvas-button")&&h.removeChild(h.querySelector(".svgcanvas-button"))},w=e=>{const n=`
    <div class="hotzone-container">
        <div class="img-container">
            <img class="img"  data-key="${e.key}" src="${e.imgurl}">
        </div>
    </div>
    `,o=document.createElement("div");o.innerHTML=n;const t=o.querySelector(".img");t.onload=()=>{const c=t.naturalWidth,v=t.naturalHeight;c>v?(t.style.width="750px",t.style.height="auto"):(t.style.width="auto",t.style.height="750px")};const i=["#12a3ff","#30c0ff","#54e3ff","#37f4b0","#02cca6","#b1ef7b","#f4e916","#f2af19","#ef701b","#ff80e1"];let l=e.hotx,u=e.hoty,f=e.hotw,y=e.hoth,s=[];for(let c=0;c<e.cnt;c++){const v=i[c%i.length];s.push(v)}const d=o.querySelector(".img-container");for(let c=0;c<e.cnt;++c){const v=document.createElement("div");v.classList.add("img-hotzone"),v.style.left=`${l[c]}%`,v.style.top=`${u[c]}%`,v.style.width=`${f[c]}%`,v.style.height=`${y[c]}%`,v.style.backgroundColor=s[c],v.textContent=`热区${c+1}`,L(v),d.appendChild(v)}q();const p=`
    <div class="hotzone-button">
        <button class="save-button">${z}</button>
    </div>
    `,a=document.createElement("div");a.innerHTML=p,a.querySelector(".save-button").addEventListener("click",()=>_(e.key)),h.appendChild(a.querySelector(".hotzone-button"));const r=`
    <div class="tooltip-container">
        <div>彩色热区<div style="display:inline-block;background-color:red;border: 2px dashed #FFF;opacity: 0.66;margin-left:2px;margin-right:2px;padding:0px;width:12px;height:12px;"></div>代表可触发区域 </div>
        <div>拖动热区边缘，调整大小；拖动热区，调整位置</div>
    </div>
    `,g=document.createElement("div");g.innerHTML=r,h.appendChild(g.querySelector(".tooltip-container")),h.appendChild(o.querySelector(".hotzone-container"))},A=e=>{console.log(e);let n=e.eldict,o=document.body.querySelector(".ezdrop-mask").querySelector(".img-container"),t=o.querySelectorAll(".effect-element"),i=o.getBoundingClientRect();console.log(n);const l=i.x,u=i.y,f=i.width,y=i.height;for(let s of t){s.childNodes[0];const d=s.getBoundingClientRect();n[s.dataset.key].elx=(d.x-l)/f*100,n[s.dataset.key].ely=(d.y-u)/y*100,n[s.dataset.key].elw=d.width/f*100,n[s.dataset.key].elh=d.height/y*100}console.log(n),S("updatedSvgCanvas",{key:e.key,eldict:n}),document.body.removeChild(document.body.querySelector(".ezdrop-mask"))},$=e=>{if(e.freshsvgcanvas){if(console.log(e),e.type==="update"){console.log(e);let n=e.eldict,o=e.updatekey,t=document.body.querySelector(".ezdrop-mask").querySelector(".img-container"),i=t.querySelectorAll(".effect-element"),l=t.getBoundingClientRect();const u=l.x,f=l.y,y=l.width,s=l.height;for(let d=0;d<i.length;d++)if(i[d].dataset.key===o){let p=n[o].elcode,a=document.createElement("div");a.innerHTML=p;let r=a.childNodes[0];r.style.pointerEvents="all";const g=i[d].getBoundingClientRect();r.style.left=`${(g.x-u)/y*100}%`,r.style.top=`${(g.y-f)/s*100}%`,r.style.width=`${g.width/y*100}%`,r.style.height=`${g.height/s*100}%`,r.classList.add("effect-element"),r.dataset.key=o,k(r),console.log(r),t.replaceChild(r,i[d])}}else if(e.type==="add"){let n=e.keylist,o=document.body.querySelector(".ezdrop-mask").querySelector(".img-container"),t=o.querySelectorAll(".effect-element"),i=e.addkey,l=e.eldict;document.body.querySelector(".img-container");let u=l[i].elcode,f=l[i].elx,y=l[i].ely,s=l[i].elw,d=l[i].elh,p=document.createElement("div");p.innerHTML=u;let a=p.childNodes[0];a.style.pointerEvents="all",a.classList.add("effect-element"),a.dataset.key=i,a.style.left=`${f}%`,a.style.top=`${y}%`,s!=="auto"?a.style.width=`${s}%`:a.style.width=`${s}`,d!=="auto"?a.style.height=`${d}%`:a.style.height=`${d}`,k(a);let r=[];for(let c=t.length-1;c>=0;c--)r.push(t[c].dataset.key);let g=0;for(let c=0;c<n.length;c++)r.includes(n[c])||(g=c);r.includes(i)||(console.log(g),o.insertBefore(a,t[g]))}else if(e.type==="remove"){let n=e.removekey,o=document.body.querySelector(".ezdrop-mask").querySelector(".img-container"),t=o.querySelectorAll(".effect-element");for(let i=0;i<t.length;i++)t[i].dataset.key===n&&o.removeChild(t[i])}}else{q();const n=`
        <div class="svgcanvas-container">
            <div class="img-container">
                <div class="background" data-key="${e.key}"></div>
            </div>
        </div>
        `,o=document.createElement("div");o.innerHTML=n;const t=o.querySelector(".background");let i=e.backgroundinfo[0],l=e.backgroundinfo[1],u=e.backgroundinfo[2];t.innerHTML=i,l>u?(t.childNodes[0].style.width="750px",t.childNodes[0].style.height=`${u*750/l}px`):(t.childNodes[0].style.width=`${l*750/u}px`,t.childNodes[0].style.height="750px");for(let s of e.keylist){let d=e.eldict[s],p=d.elcode;if(p!==""){let a=d.elx,r=d.ely,g=d.elw,c=d.elh;const v=o.querySelector(".img-container");let m=document.createElement("div");m.innerHTML=p,m=m.childNodes[0],m.style.pointerEvents="all",m.classList.add("effect-element"),m.dataset.key=s,m.style.left=`${a}%`,m.style.top=`${r}%`,g!=="auto"?m.style.width=`${g}%`:m.style.width=`${g}`,c!=="auto"?m.style.height=`${c}%`:m.style.height=`${c}`,k(m),v.appendChild(m)}}const f=`
        <div class="svgcanvas-button">
            <button class="save-button">${z}</button>
        </div>
        `,y=document.createElement("div");y.innerHTML=f,y.querySelector(".save-button").addEventListener("click",()=>A(e)),h.appendChild(y.querySelector(".svgcanvas-button")),h.appendChild(o.querySelector(".svgcanvas-container"))}},E=e=>{q();const n=`
    <div class="hotzone-container">
        <div class="img-container">
            <div class="background" data-key="${e.key}"></div>
        </div>
    </div>
    `,o=document.createElement("div");o.innerHTML=n;const t=o.querySelector(".background");let i=e.backgroundinfo[0],l=e.backgroundinfo[1],u=e.backgroundinfo[2];t.innerHTML=i,l>u?(t.childNodes[0].style.width="750px",t.childNodes[0].style.height=`${u*750/l}px`):(t.childNodes[0].style.width=`${l*750/u}px`,t.childNodes[0].style.height="750px");const f="red";let y=e.hotx,s=e.hoty,d=e.hotw,p=e.hoth;const a=o.querySelector(".img-container"),r=document.createElement("div");r.classList.add("audio-hotzone"),r.style.left=`${y}%`,r.style.top=`${s}%`,r.style.width=`${d}%`,r.style.height=`${p}%`,r.style.backgroundColor=f,L(r),a.appendChild(r);const g=`
    <div class="hotzone-button">
        <button class="save-button">${z}</button>
    </div>
    `,c=document.createElement("div");c.innerHTML=g,c.querySelector(".save-button").addEventListener("click",()=>R(e.key)),h.appendChild(c.querySelector(".hotzone-button"));const v=`
    <div class="tooltip-container">
        <div>彩色热区<div style="display:inline-block;background-color:red;border: 2px dashed #FFF;opacity: 0.66;margin-left:2px;margin-right:2px;padding:0px;width:12px;height:12px;"></div>代表可触发区域 </div>
        <div>拖动热区边缘，调整大小；拖动热区，调整位置</div>
    </div>
    `,m=document.createElement("div");m.innerHTML=v,h.appendChild(m.querySelector(".tooltip-container")),h.appendChild(o.querySelector(".hotzone-container"))},R=e=>{let n=document.body.querySelector(".ezdrop-mask").querySelector(".img-container"),o=n.querySelector(".audio-hotzone"),t=n.getBoundingClientRect();const i=t.x,l=t.y,u=t.width,f=t.height;let y=0,s=0,d=0,p=0;const a=o.getBoundingClientRect();y=(a.x-i)/u*100,s=(a.y-l)/f*100,d=a.width/u*100,p=a.height/f*100,S("updatedAudioHotZone",{key:e,hotx:y,hoty:s,hotw:d,hoth:p}),document.body.removeChild(document.body.querySelector(".ezdrop-mask"))};let H=()=>{x&&x.disconnect(),x=chrome.runtime.connect({name:"emask"}),x.onMessage.addListener(e=>{e.showhotzone&&(C(),w(e)),e.freshhotzone&&h.querySelector(".img").dataset.key===e.key&&document.body.querySelector(".ezdrop-mask")&&w(e),e.closehotzone&&document.body.querySelector(".ezdrop-mask")&&document.body.removeChild(document.body.querySelector(".ezdrop-mask")),e.showsvgcanvas&&(C(),$(e)),e.freshsvgcanvas&&h.querySelector(".background").dataset.key===e.key&&document.body.querySelector(".ezdrop-mask")&&$(e),e.closesvgcanvas&&document.body.querySelector(".ezdrop-mask")&&document.body.removeChild(document.body.querySelector(".ezdrop-mask")),e.showaudiohotzone&&(C(),E(e))}),x.onDisconnect.addListener(()=>{console.log("连接断开"),x=null}),console.log("重新连接")},x=null;H();setInterval(H,3*60*1e3);
