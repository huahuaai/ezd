chrome.runtime.onMessage.addListener((e,o,t)=>(e.getImportBtn&&fetch(chrome.runtime.getURL("src/components/importbtn.html")).then(n=>n.text()).then(n=>{t({import_btn_string:n})}).catch(n=>console.error(n)),!0));chrome.runtime.onMessage.addListener((e,o,t)=>(e.getOpenspBtn&&fetch(chrome.runtime.getURL("src/components/opensidepanelbtn.html")).then(n=>n.text()).then(n=>{t({opensp_btn_string:n})}).catch(n=>console.error(n)),!0));let s="",a=e=>{chrome.storage.local.remove(e,()=>{console.log("Data removed for key",e)})};chrome.tabs.onUpdated.addListener(()=>{chrome.tabs.query({url:"https://mp.weixin.qq.com/cgi-bin/*"},function(e){console.log(e),s=e[0].id,console.log(s)})});chrome.runtime.onMessage.addListener((e,o,t)=>(e.docloaded&&(console.log("loaded"),t({wxTabId:s})),!0));chrome.runtime.onMessage.addListener((e,o,t)=>(e.opensidepanel&&(console.log("open"),chrome.sidePanel.open({tabId:s})),!0));const c=/^https:\/\/mp\.weixin\.qq\.com\/cgi-bin\/.*$/;chrome.tabs.onUpdated.addListener(async(e,o,t)=>{if(!t.url)return;const n=new URL(t.url);c.test(n)?await chrome.sidePanel.setOptions({tabId:e,path:"src/sidepanel/index.html",enabled:!0}):await chrome.sidePanel.setOptions({tabId:e,enabled:!1})});chrome.tabs.onRemoved.addListener(function(e,o){e===s&&(console.log("我关心的标签页被关闭了"),a("cachedElementData"),a("cachedCountData"))});let r=null;chrome.runtime.onConnect.addListener(e=>{console.log(e),e.name==="getSidePanelStatus"&&(r=e),console.log(r),e.name==="SidePanel"&&(r.postMessage({spopen:!0}),e.onDisconnect.addListener(()=>{r.postMessage({spclose:!0})}))});
