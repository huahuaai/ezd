chrome.runtime.onMessage.addListener((e,t,n)=>(e.getDropBtn&&fetch(chrome.runtime.getURL("src/components/dropbtn.html")).then(r=>r.text()).then(r=>{n({drop_btn_string:r})}).catch(r=>console.error(r)),!0));chrome.runtime.onMessage.addListener((e,t,n)=>(e.opensidepanel&&chrome.tabs.query({active:!0,currentWindow:!0},function(r){let d=r[0];chrome.sidePanel.open({tabId:d.id})}),!0));const c=/^https:\/\/mp\.weixin\.qq\.com\/cgi-bin\/.*$/;chrome.tabs.onUpdated.addListener(async(e,t,n)=>{if(!n.url)return;const r=new URL(n.url);c.test(r)?await chrome.sidePanel.setOptions({tabId:e,path:"src/sidepanel/index.html",enabled:!0}):await chrome.sidePanel.setOptions({tabId:e,enabled:!1})});chrome.windows.onRemoved.addListener(function(){chrome.windows.getAll({populate:!1},function(e){e.length===0&&(chrome.storage.local.clear(function(){console.log("本地存储已清空")}),chrome.storage.local.get("cachedElementData",function(t){console.log(t)}),l())})});chrome.tabs.onActivated.addListener(()=>{chrome.runtime.sendMessage({loadData:!0})});let s="";chrome.runtime.onMessage.addListener((e,t,n)=>(e.savedCode&&(s=e.savedCode),!0));chrome.runtime.onConnect.addListener(e=>{e.name==="svgcode"&&chrome.runtime.onMessage.addListener((t,n,r)=>(t.savedCode&&e.postMessage({svgcode:t.savedCode}),!0))});chrome.runtime.onMessage.addListener((e,t,n)=>e.hascode?n({svgcode:s}):!0);chrome.runtime.onMessage.addListener((e,t,n)=>(e.clearcode&&(s=""),!0));let a;async function o(){await chrome.storage.local.set({"last-heartbeat":new Date().getTime()})}async function i(){o().then(()=>{a=setInterval(o,20*1e3)})}i();async function l(){clearInterval(a)}
